name: Blog Image Check

on:
  push:
    paths:
      - 'public/blogs/images/*.png'

permissions:
  issues: write

jobs:
  check-image:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Verify ansible-systemd-module.png exists
        id: check_image
        run: |
          if [ -f public/blogs/images/ansible-systemd-module.png ]; then
            echo "found=true" >> $GITHUB_OUTPUT
          else
            echo "found=false" >> $GITHUB_OUTPUT
          fi

      - name: Update Issue #21 checkbox
        if: steps.check_image.outputs.found == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            const issue_number = 21;

            // Get the issue body
            const issue = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number
            });

            let body = issue.data.body;

            // Replace unchecked box with checked one
            body = body.replace(
              "- [ ] blogs/images/ansible-systemd-module.png",
              "- [x] blogs/images/ansible-systemd-module.png"
            );

            // Update issue
            await github.rest.issues.update({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number,
              body
            });
